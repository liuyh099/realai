<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.realai.online.core.dao.BatchRecordDao">
    <resultMap type="cn.realai.online.core.entity.BatchRecord" id="BatshRecordMap">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="y_table" property="ytableDataSource" jdbcType="VARCHAR"/>
        <result column="x_table_homo" property="xtableHomogeneousDataSource" jdbcType="VARCHAR"/>
        <result column="x_table_Heter" property="xtableHeterogeneousDataSource" jdbcType="VARCHAR"/>
        <result column="experiment_id" property="experimentId" jdbcType="BIGINT"/>
        <result column="service_id" property="serviceId" jdbcType="BIGINT"/>
        <result column="create_time" property="createTime" jdbcType="BIGINT"/>
        <result column="down_url" property="downUrl" jdbcType="VARCHAR"/>
        <result column="batch_type" property="batchType" jdbcType="INTEGER"/>
        <result column="batch_name" property="batchName" jdbcType="VARCHAR"/>
    </resultMap>

    <insert id="insert">
        <selectKey resultType="java.lang.Long" order="AFTER" keyProperty="id">
            SELECT LAST_INSERT_ID() AS id
        </selectKey>
        INSERT INTO batch_record (y_table , x_table_homo, x_table_Heter, experiment_id, service_id,
        create_time, down_url, batch_type, batch_name, date)
        VALUE (#{batchRecord.ytableDataSource},#{batchRecord.xtableHomogeneousDataSource},
        #{batchRecord.xtableHeterogeneousDataSource},#{batchRecord.experimentId},#{batchRecord.serviceId},
        #{batchRecord.createTime},#{batchRecord.downUrl},#{batchRecord.batchType},#{batchRecord.batchName})
    </insert>

    <select id="get" resultMap="BatshRecordMap" parameterType="java.lang.Long">
        SELECT * FROM batch_record WHERE id = #{id}
    </select>

    <select id="getByEntity" resultMap="BatshRecordMap" parameterType="cn.realai.online.core.entity.BatchRecord">
        SELECT * FROM batch_record
        <where>
            1=1
            <if test="experimentId!=null">
                AND experiment_id = #{experimentId}
            </if>
            <if test="batchType!=null">
                AND batch_type = #{batchType}
            </if>
            <if test="batchName!=null">
                AND batch_name = #{batchName}
            </if>
            <if test="id!=null">
                AND id = #{id}
            </if>
            <if test="serviceId!=null">
                AND service_id = #{serviceId}
            </if>
        </where>
    </select>
    
    <select id="getBatchRecordByEidAndDate" resultMap="BatshRecordMap">
    	select * 
    	from batch_record
    	where experiment_id = #{eid}
		and FROM_UNIXTIME(create_time/1000,'%Y%m%d') = #{date}
		and batchType = #{batchType}
    </select>

</mapper>